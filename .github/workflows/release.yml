# Run scripts by release

name: Release

on:
  push:
    branches: [ matrix ]

  workflow_dispatch:

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Get python's version
        run: python3 --version

      - name: Get make's version
        run: make --version
        
      - name: View environment
        run: echo "${{toJson(github)}}"
        
      - name: Run make release
        run: cd $HOME/work/kodi/kodi/ && make release

      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: Apply release
          
      - name: Send result to email
        if: always()
        uses: dawidd6/action-send-mail@v2
        with:
          server_address: smtp.gmail.com
          server_port: 465
          # user credentials
          username: ${{secrets.EMAIL_USERNAME}}
          password: ${{secrets.EMAIL_PASSWORD}}
          # email subject
          subject: ${{github.job}} job of ${{github.repository}} has ${{job.status}}
          # email body as text
          body: ${{github.job}} job in worflow ${{github.workflow}} of ${{github.repository}} has ${{job.status}}
          # comma-separated string, send email to
          to: dandy@tut.by, denis.bolotin.dandy@gmail.com
          # from email name
          from: Github Actions
          
